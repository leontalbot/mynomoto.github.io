(ns hoplon.vega
  (:require
    [cljsjs.vega]))

(defn chart [spec data]
  (with-let [c (div)]
    (with-init!
      (.spec (.-parse js/vg)
        spec
        (fn [chart]
          (let [view (chart (clj->js {:el c
                                      :data @data}))]
            (.update view)
            (add-watch data (gensym) (fn [k r o n]
                                       (.data view @data)
                                       (.update view)))))))))
